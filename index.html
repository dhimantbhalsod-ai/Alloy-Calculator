<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description"
    content="Silver Bracelet Alloy Calculator — compute silver, copper, and waste alloy weights for any order. Works offline.">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Alloy Calc">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" sizes="192x192" href="icons/icon-192.svg">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <title>Alloy Calculator</title>
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-inner">
        <div class="logo">
          <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
            <circle cx="14" cy="14" r="13" stroke="url(#lg)" stroke-width="2" />
            <path d="M9 18L14 8L19 18" stroke="url(#lg)" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <line x1="10.5" y1="15" x2="17.5" y2="15" stroke="url(#lg)" stroke-width="1.5" stroke-linecap="round" />
            <defs>
              <linearGradient id="lg" x1="0" y1="0" x2="28" y2="28">
                <stop stop-color="#c0a36a" />
                <stop offset="1" stop-color="#e8d5a3" />
              </linearGradient>
            </defs>
          </svg>
          <h1>Alloy Calculator</h1>
        </div>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs">
      <button class="tab active" data-tab="calculator" id="tab-calculator">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="2" width="16" height="20" rx="2" />
          <line x1="8" y1="6" x2="16" y2="6" />
          <line x1="8" y1="10" x2="10" y2="10" />
          <line x1="14" y1="10" x2="16" y2="10" />
          <line x1="8" y1="14" x2="10" y2="14" />
          <line x1="14" y1="14" x2="16" y2="14" />
          <line x1="8" y1="18" x2="16" y2="18" />
        </svg>
        Calculator
      </button>
      <button class="tab" data-tab="history" id="tab-history">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 6 12 12 16 14" />
        </svg>
        History
      </button>
    </nav>

    <!-- Calculator View -->
    <main class="view active" id="view-calculator">
      <form id="calc-form" autocomplete="off">
        <!-- Order Details -->
        <section class="card">
          <h2 class="card-title">Order Details</h2>
          <div class="field">
            <label for="total-weight">Total Weight of Order</label>
            <div class="input-wrap">
              <input type="number" id="total-weight" placeholder="e.g. 100" step="any" min="0.01" required>
              <div class="unit-toggle" id="unit-toggle">
                <button type="button" class="unit-btn active" data-unit="g">g</button>
                <button type="button" class="unit-btn" data-unit="kg">kg</button>
              </div>
            </div>
          </div>
          <div class="field">
            <label>Desired Silver Purity Range</label>
            <div class="purity-range-row">
              <div class="input-wrap">
                <input type="number" id="silver-pct-min" placeholder="Min e.g. 92" step="any" min="1" max="98.5"
                  required>
                <span class="unit">%</span>
              </div>
              <span class="range-separator">to</span>
              <div class="input-wrap">
                <input type="number" id="silver-pct-max" placeholder="Max e.g. 95" step="any" min="1" max="98.5">
                <span class="unit">%</span>
              </div>
            </div>
            <span class="field-hint">Result purity will be ≥ min. Max defaults to 98.5% if empty.</span>
          </div>
        </section>

        <!-- Fresh Metal Purities -->
        <section class="card">
          <div class="toggle-row">
            <h2 class="card-title" style="margin-bottom:0">Fresh Metal Purities</h2>
            <button type="button" class="btn-expand-toggle" id="btn-metal-purity-toggle">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9" />
              </svg>
            </button>
          </div>
          <span class="field-hint" style="margin-top:4px;">Defaults: Silver 98.50%, Copper 99%. Tap to customize.</span>
          <div class="metal-purity-fields" id="metal-purity-fields" style="display:none;">
            <div class="field">
              <label for="silver-metal-purity">Silver Metal Purity</label>
              <div class="input-wrap">
                <input type="number" id="silver-metal-purity" placeholder="98.50" step="any" min="1" max="100">
                <span class="unit">%</span>
              </div>
              <span class="field-hint">Leave empty for default 98.50%</span>
            </div>
            <div class="field">
              <label for="copper-metal-purity">Copper Metal Purity</label>
              <div class="input-wrap">
                <input type="number" id="copper-metal-purity" placeholder="99" step="any" min="1" max="100">
                <span class="unit">%</span>
              </div>
              <span class="field-hint">Leave empty for default 99%</span>
            </div>
          </div>
        </section>

        <!-- Waste Section -->
        <section class="card">
          <div class="toggle-row">
            <h2 class="card-title" style="margin-bottom:0">Use Waste Alloy</h2>
            <label class="switch" for="use-waste">
              <input type="checkbox" id="use-waste">
              <span class="slider"></span>
            </label>
          </div>
          <div class="waste-fields" id="waste-fields" style="display:none;">
            <div class="field">
              <label for="waste-count">Number of Waste Alloy</label>
              <div class="input-wrap">
                <input type="number" id="waste-count" placeholder="e.g. 1" step="1" min="1" max="10" value="1">
              </div>
              <span class="field-hint">How many different purity waste alloys will you use?</span>
            </div>
            <div id="waste-entries-container">
              <!-- Dynamic waste entries will be rendered here -->
            </div>
          </div>
        </section>

        <!-- Calculate Button -->
        <button type="submit" class="btn-calculate" id="btn-calculate">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
          </svg>
          Calculate Alloy
        </button>
      </form>

      <!-- Results -->
      <div class="results-container" id="results-container" style="display:none;">
        <section class="card results-card">
          <h2 class="card-title">Alloy Composition</h2>
          <div id="warning-box" class="warning-box" style="display:none;"></div>
          <div class="result-grid">
            <div class="result-item silver">
              <span class="result-label">Fresh Silver to Add</span>
              <span class="result-sublabel" id="res-silver-purity-label">98.50% pure</span>
              <span class="result-value" id="res-silver">—</span>
            </div>
            <div class="result-item silver" id="res-waste-silver-item" style="display:none;">
              <span class="result-label">Silver from Waste</span>
              <span class="result-sublabel">contributed by waste</span>
              <span class="result-value" id="res-silver-waste">—</span>
            </div>
            <div class="result-item copper">
              <span class="result-label">Fresh Copper to Add</span>
              <span class="result-sublabel" id="res-copper-purity-label">99% pure</span>
              <span class="result-value" id="res-copper">—</span>
            </div>
            <div class="result-item waste" id="res-waste-item" style="display:none;">
              <span class="result-label">Waste Alloy Used</span>
              <span class="result-sublabel" id="res-waste-purity-label">—</span>
              <span class="result-value" id="res-waste-used">—</span>
            </div>
            <div class="result-item waste-copper" id="res-waste-copper-item" style="display:none;">
              <span class="result-label">Copper from Waste</span>
              <span class="result-sublabel">contributed by waste</span>
              <span class="result-value" id="res-copper-waste">—</span>
            </div>
          </div>
        </section>

        <section class="card verify-card">
          <h2 class="card-title">Verification</h2>
          <div class="verify-grid">
            <div class="verify-row">
              <span>Silver from silver material</span>
              <span id="v-silver">—</span>
            </div>
            <div class="verify-row">
              <span>Silver from copper material</span>
              <span id="v-copper">—</span>
            </div>
            <div class="verify-row" id="v-waste-row" style="display:none;">
              <span>Silver from waste material</span>
              <span id="v-waste">—</span>
            </div>
            <div class="verify-row total">
              <span>Total pure silver</span>
              <span id="v-total">—</span>
            </div>
            <div class="verify-row actual">
              <span>Actual silver %</span>
              <span id="v-actual-pct">—</span>
            </div>
          </div>
        </section>

        <!-- STEP 2: Adjust Silver -->
        <section class="card block-card" id="step2-section">
          <h2 class="card-title">
            <span class="step-badge">Step 2</span> Adjust Silver Weight
          </h2>
          <p class="block-intro">Your silver comes in blocks that can't be cut. Enter the nearest weight you can manage
            from your available silver blocks.</p>
          <div class="field">
            <label for="actual-silver">Actual Silver Weight</label>
            <div class="input-wrap">
              <input type="number" id="actual-silver" placeholder="Nearest silver weight" step="any" min="0">
              <span class="unit weight-unit-label">g</span>
            </div>
            <span class="field-hint">Ideal: <strong id="ideal-silver-hint">—</strong></span>
          </div>
          <button type="button" class="btn-adjust" id="btn-step2">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6" />
            </svg>
            Calculate Required Copper
          </button>
        </section>

        <!-- Step 2 Verification -->
        <section class="card verify-card" id="step2-verify-section" style="display:none;">
          <h2 class="card-title">Step 2 — Verification (New Silver Weight)</h2>
          <div class="verify-grid">
            <div class="verify-row">
              <span>Silver from silver material</span>
              <span id="v2-silver">—</span>
            </div>
            <div class="verify-row" id="v2-waste-row" style="display:none;">
              <span>Silver from waste material</span>
              <span id="v2-waste">—</span>
            </div>
            <div class="verify-row total">
              <span>Total pure silver (before copper)</span>
              <span id="v2-total">—</span>
            </div>
            <div class="verify-row actual">
              <span>Required copper to reach target</span>
              <span id="v2-required-copper">—</span>
            </div>
          </div>
        </section>

        <!-- STEP 3: Adjust Copper -->
        <section class="card block-card" id="step3-section" style="display:none;">
          <h2 class="card-title">
            <span class="step-badge">Step 3</span> Adjust Copper Weight
          </h2>
          <div class="step3-required-box" id="step3-required-box">
            <span class="step3-required-label">Required copper for target purity:</span>
            <span class="step3-required-value" id="required-copper-display">—</span>
          </div>
          <p class="block-intro">Enter the nearest copper weight you can manage from your available copper blocks.</p>
          <div class="field">
            <label for="actual-copper">Actual Copper Weight</label>
            <div class="input-wrap">
              <input type="number" id="actual-copper" placeholder="Nearest copper weight" step="any" min="0">
              <span class="unit weight-unit-label">g</span>
            </div>
            <span class="field-hint">Required: <strong id="ideal-copper-hint">—</strong></span>
          </div>
          <button type="button" class="btn-adjust btn-final" id="btn-step3">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
            Calculate Final Result
          </button>
        </section>

        <!-- Step 3 Verification -->
        <section class="card verify-card" id="step3-verify-section" style="display:none;">
          <h2 class="card-title">Step 3 — Verification (New Copper Weight)</h2>
          <div class="verify-grid">
            <div class="verify-row">
              <span>Silver from silver material</span>
              <span id="v3-silver">—</span>
            </div>
            <div class="verify-row">
              <span>Silver from copper material</span>
              <span id="v3-copper">—</span>
            </div>
            <div class="verify-row" id="v3-waste-row" style="display:none;">
              <span>Silver from waste material</span>
              <span id="v3-waste">—</span>
            </div>
            <div class="verify-row total">
              <span>Total pure silver</span>
              <span id="v3-total">—</span>
            </div>
            <div class="verify-row actual">
              <span>Actual silver %</span>
              <span id="v3-actual-pct">—</span>
            </div>
          </div>
        </section>

        <!-- Final Adjusted Result -->
        <section class="card block-results-card" id="final-result" style="display:none;">
          <h2 class="card-title">Final Adjusted Result</h2>
          <div id="block-warning-box" class="warning-box" style="display:none;"></div>
          <div id="block-success-box" class="success-box" style="display:none;"></div>
          <div class="result-grid">
            <div class="result-item silver">
              <span class="result-label">Silver (actual)</span>
              <span class="result-sublabel">from your blocks</span>
              <span class="result-value" id="adj-silver">—</span>
            </div>
            <div class="result-item copper">
              <span class="result-label" id="adj-copper-label">Copper (adjusted)</span>
              <span class="result-sublabel" id="adj-copper-sublabel">auto-corrected for purity</span>
              <span class="result-value" id="adj-copper">—</span>
            </div>
            <div class="result-item waste" id="adj-waste-item" style="display:none;">
              <span class="result-label">Waste Used</span>
              <span class="result-sublabel">full quantity</span>
              <span class="result-value" id="adj-waste">—</span>
            </div>
          </div>
          <div class="verify-grid" style="margin-top:16px;">
            <div class="verify-row">
              <span>Adjusted total weight</span>
              <span id="adj-total-weight">—</span>
            </div>
            <div class="verify-row">
              <span>Weight difference</span>
              <span id="adj-weight-diff">—</span>
            </div>
            <div class="verify-row actual">
              <span>Actual silver %</span>
              <span id="adj-actual-pct">—</span>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- History View -->
    <main class="view" id="view-history">
      <div class="history-header">
        <h2>Calculation History</h2>
        <button class="btn-clear-all" id="btn-clear-all" style="display:none;">Clear All</button>
      </div>
      <div class="history-list" id="history-list">
        <div class="empty-state" id="empty-history">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
            stroke-linecap="round" stroke-linejoin="round" opacity="0.3">
            <circle cx="12" cy="12" r="10" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
          <p>No calculations yet</p>
          <span>Your calculations will appear here</span>
        </div>
      </div>
    </main>
  </div>

  <script src="app.js"></script>
</body>

</html>